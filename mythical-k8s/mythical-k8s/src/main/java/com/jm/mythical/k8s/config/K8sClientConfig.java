package com.jm.mythical.k8s.config;

import io.fabric8.kubernetes.client.ConfigBuilder;
import io.fabric8.kubernetes.client.KubernetesClient;
import io.fabric8.kubernetes.client.KubernetesClientBuilder;
import org.springframework.stereotype.Component;

import javax.annotation.PostConstruct;
import javax.annotation.PreDestroy;

/**
 * TODO
 *
 * @Author jinmu
 * @Date 2023/6/21 11:05
 */
@Component
public class K8sClientConfig {

    private KubernetesClient client;

    @PostConstruct
    public void init() {
        String url = "https://192.168.217.140:6443";
        String token = "ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkluUnlPVkJqT0dSRllVOTZOMk42YzNWSFRWbzNkSFY2WDBKNWVWUjJTbmt0ZG5VNWNtNUZXVTB5Y1ZraWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUptYkdsdWF5SXNJbXQxWW1WeWJtVjBaWE11YVc4dmMyVnlkbWxqWldGalkyOTFiblF2YzJWamNtVjBMbTVoYldVaU9pSnFhVzV0ZFMxMGIydGxiaTFzYm1Sek9TSXNJbXQxWW1WeWJtVjBaWE11YVc4dmMyVnlkbWxqWldGalkyOTFiblF2YzJWeWRtbGpaUzFoWTJOdmRXNTBMbTVoYldVaU9pSnFhVzV0ZFNJc0ltdDFZbVZ5Ym1WMFpYTXVhVzh2YzJWeWRtbGpaV0ZqWTI5MWJuUXZjMlZ5ZG1salpTMWhZMk52ZFc1MExuVnBaQ0k2SWpFd1ptSTRZVFE0TFRJMFlUZ3ROREkxWlMwNFpqazFMVFk0TmprMk56UXdOVEprTUNJc0luTjFZaUk2SW5ONWMzUmxiVHB6WlhKMmFXTmxZV05qYjNWdWREcG1iR2x1YXpwcWFXNXRkU0o5LllCY1VHMFFsanVWU2ctbFVRR1E1WnI5UG1fU2FXRnRNd2xhZ1M2Y1lwUXF1NTY4cWJFcngybi0ydE5zbnJtVlJtWU52WDcwemhyMlp5enNvaW1BSVJmYl82azU2S3dSTVJlaG1wcVl1by1MQ0pxRUlYNE15YXZiM0liWE5mZzFoSEhpWDZubktFS0xGRVFwVkpKajFFSWlpbnNhbVVwWGlhNVVjcXkwdXZQWmw5WlZWeEV2alpMd0NqMFJ3bTFhaXd4ekNyVG9jNWE4NXRYYnNkTVN5Z1BBaXdFNzFOM2h2YV8zX2VaTm9wQ0hWTkhOYUJ0X2FTMEZPVXdscTdfVHlkODRmc1RQYzVfSFJEUFpwNGJFR3JhUlpuTGJPeDFUb3R1ZEZXWFNOOWZreFVUd2c3YW53czNERC12cDZ5R2xuMGxoM3B1OU1FVkJNb3BKWlg3a0x1Zw==";
        String cert = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EVXlOVEEzTkRZek5Wb1hEVE16TURVeU1qQTNORFl6TlZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTGVDClI4eUxPdVhKRmx4UWRyMWFXem5PNkJSQ3FUVTZSVmVlRXNRQlVJNVU1RnB3SVcxdTk2TGRGT2NrN2svSm1mQloKLyt4bFJRSDkrUjEvTGdtWUUzVkFmM3NNVUJGSk42b0E0NndVWmtjWnVnVnNaNVI5NXNUQ1o3Yk1lazNic2d0ZwpEUGZadzdMWnJmYURvNHhaRXVnRjBPNUtiOXdPQ1BmcnpSd2N2U1laUlFnMUJBU1ExYnJ3bi9sL2JuZmN3Mk1QCnNSUC9IS3dyWCtSSTFKYmZUdmdJV3prTzJ5WFJLSWsyamhEd1o2Z2dsZnZPRXBqS3UyQkpUWEh0L3pKZ3RITmYKZEE3WWZTQ0pNOExCT293K1NjRzBySFRlOHpFYTRKVHpjL2xzcVJnbjlaSDJ1VWIyNlZXOUJQTEJ5V0gycGxEVgpnL2xiVitEOGQyMm5YOXZJN0wwQ0F3RUFBYU5DTUVBd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZJMGtDVGN0QzVPb2FZQmJKNVh6cEJ6VGdsRlhNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCQVFBSkRCMHVFYmEvMTRmVFBjMi9taXE5TURmN0NZYUplUEUzWXZDMUpkZzV0UktKZWQ1dQo5ZGY5NWg0bXhmQTZLVFNzZU5JOFJrSzMrcGlDTnhvYjFHWXFuK3ZYWW1WOWhFdE9lcmhnd2k4YWdPVEN0eEl6CjRxK251R0I4amFtdU42bTV0WUt5YjZmQWNPM0ZtTWVLMXdrcU5sUHlYQTZCUzc5RVlSR0xpNEVNQ09VZEdIU3cKSU5WV3VneFBLYTRaNVFPZDZrWjZ6enFCQ0s2SlltN3NDbERwbmVQSDJETlRXZlJaNHJUZUlRdUNrbk5FTlRGMwpQMlVuaTFuQy9QdEtlOHJ4WEx4cE80WVloSDVhc0M0QUNuOTgvZWRDNG1JdEVtMjUvK0pkbHo3Ukh1WTZicURMCkFCdThxSFBoMXVxdjczeDl3c04rWUZBWjRhdTNFNUJRSFpJMQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==";

        //String token = "ZXlKaGJHY2lPaUpTVXpJMU5pSXNJbXRwWkNJNkluUnlPVkJqT0dSRllVOTZOMk42YzNWSFRWbzNkSFY2WDBKNWVWUjJTbmt0ZG5VNWNtNUZXVTB5Y1ZraWZRLmV5SnBjM01pT2lKcmRXSmxjbTVsZEdWekwzTmxjblpwWTJWaFkyTnZkVzUwSWl3aWEzVmlaWEp1WlhSbGN5NXBieTl6WlhKMmFXTmxZV05qYjNWdWRDOXVZVzFsYzNCaFkyVWlPaUpyZFdKbGMzQm9aWEpsTFdOdmJuUnliMnh6TFhONWMzUmxiU0lzSW10MVltVnlibVYwWlhNdWFXOHZjMlZ5ZG1salpXRmpZMjkxYm5RdmMyVmpjbVYwTG01aGJXVWlPaUpyZFdKbGMzQm9aWEpsTFdOc2RYTjBaWEl0WVdSdGFXNHRkRzlyWlc0dGVHMTZjVFVpTENKcmRXSmxjbTVsZEdWekxtbHZMM05sY25acFkyVmhZMk52ZFc1MEwzTmxjblpwWTJVdFlXTmpiM1Z1ZEM1dVlXMWxJam9pYTNWaVpYTndhR1Z5WlMxamJIVnpkR1Z5TFdGa2JXbHVJaXdpYTNWaVpYSnVaWFJsY3k1cGJ5OXpaWEoyYVdObFlXTmpiM1Z1ZEM5elpYSjJhV05sTFdGalkyOTFiblF1ZFdsa0lqb2lOVGM0TlRFeU1XRXRZVE00WVMwMFlqYzFMVGc0TUdVdE1qQXdaREkwT1RZNVpERm1JaXdpYzNWaUlqb2ljM2x6ZEdWdE9uTmxjblpwWTJWaFkyTnZkVzUwT210MVltVnpjR2hsY21VdFkyOXVkSEp2YkhNdGMzbHpkR1Z0T210MVltVnpjR2hsY21VdFkyeDFjM1JsY2kxaFpHMXBiaUo5LmtWSzlacFZYZ0YxVTZqellFR2lNTU5tVXBzZzVMWUZHdVRNR0d3M2g3cWdOOWVuNXBaUV9VLUxyaV8xSTgwR2JsR1NVcl8ybmtUSm42WGhmdFhsSWhlWm5PcE53VlMycHpLS1ZMUUJNRDdncnhnNHZRV1JrZlZSbEpqTVF3ZTVYVkM5WUV5eG9JNFF0c1JxZElQaHd2RXN1dVpFLVVIb21wOU5mRnF4RlYtR3FNc1puclhiaS16dTJpTGpvczNJczJoM1cybVdFaGNDQ2V6MzVqOFR0TF96TnI1dXF0M1ZKYUdTMDVmbWpUQkhwaWs5SXZFanU3NUhrb0pBaGxFZGIyS28xSnZMSTZKS2VxZ3VHRk10X2dUXzFsWS0wbGw0Mlg0cXBZd1NXUkQ1RHRRVTFyaWt6aUVxUFhWVVJmSi1FcjZnakhFeHdVMXN1RloyUWQ3NlZWQQ==";
        //String cert = "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM1ekNDQWMrZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EVXlOVEEzTkRZek5Wb1hEVE16TURVeU1qQTNORFl6TlZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTGVDClI4eUxPdVhKRmx4UWRyMWFXem5PNkJSQ3FUVTZSVmVlRXNRQlVJNVU1RnB3SVcxdTk2TGRGT2NrN2svSm1mQloKLyt4bFJRSDkrUjEvTGdtWUUzVkFmM3NNVUJGSk42b0E0NndVWmtjWnVnVnNaNVI5NXNUQ1o3Yk1lazNic2d0ZwpEUGZadzdMWnJmYURvNHhaRXVnRjBPNUtiOXdPQ1BmcnpSd2N2U1laUlFnMUJBU1ExYnJ3bi9sL2JuZmN3Mk1QCnNSUC9IS3dyWCtSSTFKYmZUdmdJV3prTzJ5WFJLSWsyamhEd1o2Z2dsZnZPRXBqS3UyQkpUWEh0L3pKZ3RITmYKZEE3WWZTQ0pNOExCT293K1NjRzBySFRlOHpFYTRKVHpjL2xzcVJnbjlaSDJ1VWIyNlZXOUJQTEJ5V0gycGxEVgpnL2xiVitEOGQyMm5YOXZJN0wwQ0F3RUFBYU5DTUVBd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZJMGtDVGN0QzVPb2FZQmJKNVh6cEJ6VGdsRlhNQTBHQ1NxR1NJYjMKRFFFQkN3VUFBNElCQVFBSkRCMHVFYmEvMTRmVFBjMi9taXE5TURmN0NZYUplUEUzWXZDMUpkZzV0UktKZWQ1dQo5ZGY5NWg0bXhmQTZLVFNzZU5JOFJrSzMrcGlDTnhvYjFHWXFuK3ZYWW1WOWhFdE9lcmhnd2k4YWdPVEN0eEl6CjRxK251R0I4amFtdU42bTV0WUt5YjZmQWNPM0ZtTWVLMXdrcU5sUHlYQTZCUzc5RVlSR0xpNEVNQ09VZEdIU3cKSU5WV3VneFBLYTRaNVFPZDZrWjZ6enFCQ0s2SlltN3NDbERwbmVQSDJETlRXZlJaNHJUZUlRdUNrbk5FTlRGMwpQMlVuaTFuQy9QdEtlOHJ4WEx4cE80WVloSDVhc0M0QUNuOTgvZWRDNG1JdEVtMjUvK0pkbHo3Ukh1WTZicURMCkFCdThxSFBoMXVxdjczeDl3c04rWUZBWjRhdTNFNUJRSFpJMQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==";

        io.fabric8.kubernetes.client.Config config = new ConfigBuilder()
                .withMasterUrl(url)
                .withOauthToken(token)
                .withCaCertData(cert)
                .build();

        this.client = new KubernetesClientBuilder()
                .withConfig(config)
                .build();

    }

    @PreDestroy
    public void clean() {
        if (this.client != null) {
            this.client.close();
        }
    }

    public KubernetesClient getClient() {
        return client;
    }
}
